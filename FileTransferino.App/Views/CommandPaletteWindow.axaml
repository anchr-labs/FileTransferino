<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:FileTransferino.App.ViewModels"
        x:Class="FileTransferino.App.Views.CommandPaletteWindow"
        x:DataType="vm:CommandPaletteViewModel"
        Title="Command Palette"
        Width="600"
        Height="430"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        Topmost="True"
        Background="Transparent"
        TransparencyLevelHint="Transparent"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="30"
        SystemDecorations="None">

    <Window.Styles>
        <Style Selector="TextBox">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="CaretBrush" Value="{DynamicResource TextPrimaryBrush}" />
            <Setter Property="SelectionBrush" Value="{DynamicResource AccentHoverBrush}" />
            <Setter Property="FontSize" Value="{DynamicResource FontSizeBase}" />
        </Style>
        
        <!-- Ensure TextBox background stays consistent -->
        <Style Selector="TextBox /template/ Border#PART_BorderElement">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
        </Style>
        
        <!-- Focused TextBox gets a subtle glow -->
        <Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource AccentHoverBrush}" />
            <Setter Property="BorderThickness" Value="0,0,0,2" />
        </Style>
        
        <!-- Pointer over state -->
        <Style Selector="TextBox:pointerover /template/ Border#PART_BorderElement">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
        </Style>
        
        <!-- Watermark text -->
        <Style Selector="TextBox /template/ TextBlock#PART_Watermark">
            <Setter Property="Foreground" Value="{DynamicResource WatermarkBrush}" />
        </Style>
        
        <Style Selector="ListBox">
            <Setter Property="Background" Value="{DynamicResource BackgroundBrush}" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>
        
        <Style Selector="TextBlock.commandName">
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
            <Setter Property="FontSize" Value="{DynamicResource FontSizeBase}" />
            <Setter Property="FontWeight" Value="Medium" />
        </Style>
        
        <Style Selector="TextBlock.commandCategory">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
            <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}" />
        </Style>
    </Window.Styles>

    <!-- Main border that wraps everything -->
    <Border Background="{DynamicResource BackgroundBrush}"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="8"
            ClipToBounds="True"
            Opacity="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" Color="#000000" Opacity="0.3" OffsetX="0" OffsetY="4"/>
        </Border.Effect>
        <DockPanel>
            <!-- Custom Title Bar -->
            <Border DockPanel.Dock="Top" 
                    Height="30" 
                    Background="{DynamicResource SurfaceBrush}"
                    x:Name="TitleBar"
                    PointerPressed="OnTitleBarPointerPressed">
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <!-- Icon and Title -->
                    <StackPanel Grid.Column="0" 
                                Orientation="Horizontal" 
                                Margin="12,0,0,0"
                                VerticalAlignment="Center">
                        <TextBlock Text="⌘" 
                                   FontSize="14" 
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,6,0"/>
                        <TextBlock Text="Command Palette" 
                                   FontSize="12"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- Window Controls -->
                    <StackPanel Grid.Column="2" 
                                Orientation="Horizontal"
                                Spacing="0">
                        <Button Content="−" 
                                Click="MinimizeWindow" 
                                Width="45" 
                                Height="30"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="{DynamicResource TextSecondaryBrush}"
                                FontSize="16"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Padding="0">
                            <Button.Styles>
                                <Style Selector="Button:pointerover /template/ ContentPresenter">
                                    <Setter Property="Background" Value="{DynamicResource AccentHoverBrush}" />
                                </Style>
                            </Button.Styles>
                        </Button>
                        <Button Content="✕" 
                                Click="CloseWindow" 
                                Width="45" 
                                Height="30"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="{DynamicResource TextSecondaryBrush}"
                                FontSize="14"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Padding="0">
                            <Button.Styles>
                                <Style Selector="Button:pointerover /template/ ContentPresenter">
                                    <Setter Property="Background" Value="#C42B1C" />
                                </Style>
                                <Style Selector="Button:pointerover">
                                    <Setter Property="Foreground" Value="White" />
                                </Style>
                            </Button.Styles>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Search Box -->
            <TextBox DockPanel.Dock="Top"
                     Text="{Binding SearchText}"
                     Watermark="Type to search commands..."
                     Padding="12"
                     FontSize="16"
                     BorderThickness="0,0,0,1"
                     x:Name="SearchBox" />

            <!-- Command List -->
            <ListBox x:Name="CommandList"
                     ItemsSource="{Binding FilteredCommands}"
                     SelectedItem="{Binding SelectedCommand}"
                     BorderThickness="0"
                     Margin="0">
                <ListBox.ItemContainerTheme>
                    <ControlTheme TargetType="ListBoxItem">
                        <Setter Property="Padding" Value="16,10" />
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="BorderThickness" Value="0" />
                        <Setter Property="Template">
                            <ControlTemplate>
                                <Border Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        Padding="{TemplateBinding Padding}"
                                        CornerRadius="4">
                                    <ContentPresenter Content="{TemplateBinding Content}"
                                                      ContentTemplate="{TemplateBinding ContentTemplate}" />
                                </Border>
                            </ControlTemplate>
                        </Setter>
                        
                        <!-- Hover -->
                        <Style Selector="^:pointerover">
                            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
                        </Style>
                        
                        <!-- Selected -->
                        <Style Selector="^:selected">
                            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
                            <Setter Property="BorderThickness" Value="0,0,0,2" />
                            <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}" />
                        </Style>
                        
                        <!-- Selected AND hovered -->
                        <Style Selector="^:selected:pointerover">
                            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
                            <Setter Property="BorderThickness" Value="0,0,0,2" />
                            <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}" />
                        </Style>
                    </ControlTheme>
                </ListBox.ItemContainerTheme>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Spacing="4">
                            <TextBlock Text="{Binding Name}" 
                                       Classes="commandName" />
                            <TextBlock Text="{Binding Category}" 
                                       Classes="commandCategory" />
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </DockPanel>
    </Border>
</Window>
