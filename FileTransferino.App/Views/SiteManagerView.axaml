<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FileTransferino.App.ViewModels"
             xmlns:converters="using:FileTransferino.App.Converters"
             x:Class="FileTransferino.App.Views.SiteManagerView"
             x:DataType="vm:SiteManagerViewModel">

    <UserControl.Styles>
        <Style Selector="Border.card">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
        </Style>

        <Style Selector="TextBlock.secondary">
            <Setter Property="Foreground" Value="{DynamicResource LabelBrush}" />
            <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}" />
        </Style>

        <!-- Scoped overlay scrollbar styling for ScrollViewers inside this view -->
        <Style Selector="ScrollViewer ScrollBar">
            <!-- Make the scrollbar thinner and allow it to overlap content by using a negative margin -->
            <Setter Property="Width" Value="10" />
            <Setter Property="Background" Value="Transparent" />
            <!-- Negative right margin moves the bar slightly over the content so it doesn't push layout -->
            <Setter Property="Margin" Value="-8,0,0,0" />
        </Style>

        <Style Selector="ScrollViewer ScrollBar Thumb">
            <!-- Slightly darker subtle thumb; uses AccentBrush when available -->
            <Setter Property="Background" Value="{DynamicResource AccentBrush}" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Opacity" Value="0.75" />
        </Style>

    </UserControl.Styles>

    <Grid RowDefinitions="*,Auto" Margin="20">
        <!-- Main Content -->
        <Grid Grid.Row="0" ColumnDefinitions="250,*">
            <!-- Left: Site List -->
            <Border Grid.Column="0" 
                    Classes="card"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="0"
                    Margin="0,0,10,0">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top"
                               Text="Saved Sites"
                               FontWeight="SemiBold"
                               FontSize="14"
                               Margin="12,12,12,8"
                               Foreground="{DynamicResource TextPrimaryBrush}" />
                    
                    <ListBox ItemsSource="{Binding Sites}"
                             SelectedItem="{Binding SelectedSite}"
                             Background="{DynamicResource SurfaceBrush}"
                             BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Spacing="2" Margin="4">
                                    <TextBlock Text="{Binding Name}" 
                                               FontWeight="Medium"
                                               Foreground="{DynamicResource TextPrimaryBrush}" />
                                    <TextBlock FontSize="11"
                                               Classes="secondary">
                                        <Run Text="{Binding Protocol}" />
                                        <Run Text="://" />
                                        <Run Text="{Binding Host}" />
                                        <Run Text=":" />
                                        <Run Text="{Binding Port}" />
                                    </TextBlock>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>

            <!-- Right: Site Details Form -->
            <Border Grid.Column="1"
                    Classes="card"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="20,20,4,20">
                <ScrollViewer Padding="0">
                    <StackPanel Spacing="16" Margin="0">
                        <!-- Getting Started (visible when no sites exist) -->
                        <Border IsVisible="{Binding HasNoSites}"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="24"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Top">
                            <StackPanel Spacing="12">
                                <TextBlock Text="Welcome to FileTransferino"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource TextPrimaryBrush}" />
                                <TextBlock Text="Get started by adding your first site."
                                           Foreground="{DynamicResource TextSecondaryBrush}" />
                                <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,12,0,0">
                                    <Button Content="+ Add Site"
                                            Width="120"
                                            Command="{Binding NewSiteCommand}"
                                            Click="OnAddSiteClick"
                                            IsEnabled="True" />
                                    <Button Content="Learn More"
                                            Width="120"
                                            Command="{Binding OpenDocsCommand}"
                                            Click="OnLearnMoreClick"
                                            IsEnabled="True" />
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Existing Site Form (visible when sites exist or editing) -->
                        <StackPanel IsVisible="{Binding HasNoSites, Converter={x:Static converters:BoolInverseConverter.Instance}}" Spacing="16" Margin="0,0,12,0">
                            <TextBlock Text="Site Configuration"
                                       FontWeight="SemiBold"
                                       FontSize="{DynamicResource FontSizeLarge}"
                                       Foreground="{DynamicResource TextPrimaryBrush}" />

                            <!-- Name -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Site Name *"
                                           Foreground="{DynamicResource LabelBrush}" />
                                <TextBox Text="{Binding Name}" 
                                         Watermark="My FTP Server"
                                         Background="{DynamicResource SurfaceBrush}" />
                            </StackPanel>

                            <!-- Protocol -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Protocol *"
                                           Foreground="{DynamicResource LabelBrush}" />
                                <ComboBox SelectedItem="{Binding Protocol}"
                                          HorizontalAlignment="Stretch"
                                          Background="{DynamicResource SurfaceBrush}"
                                          Foreground="{DynamicResource TextPrimaryBrush}">
                                    <ComboBoxItem Content="FTP" />
                                    <ComboBoxItem Content="FTPS" />
                                    <ComboBoxItem Content="SFTP" />
                                </ComboBox>
                            </StackPanel>

                            <!-- Host -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Host *"
                                           Foreground="{DynamicResource LabelBrush}" />
                                <TextBox Text="{Binding Host}"
                                         Watermark="ftp.example.com"
                                         Background="{DynamicResource SurfaceBrush}"
                                         Foreground="{DynamicResource TextPrimaryBrush}" />
                            </StackPanel>

                            <!-- Port -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Port *"
                                           Foreground="{DynamicResource LabelBrush}" />
                                <NumericUpDown Value="{Binding Port}"
                                               Minimum="1"
                                               Maximum="65535"
                                               HorizontalAlignment="Stretch"
                                               Background="{DynamicResource SurfaceBrush}"
                                               Foreground="{DynamicResource TextPrimaryBrush}" />
                            </StackPanel>

                            <!-- Username -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Username"
                                           Foreground="{DynamicResource LabelBrush}" />
                                <TextBox Text="{Binding Username}"
                                         Watermark="username"
                                         Background="{DynamicResource SurfaceBrush}"
                                         Foreground="{DynamicResource TextPrimaryBrush}" />
                            </StackPanel>

                            <!-- Password -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Password"
                                           Foreground="{DynamicResource LabelBrush}" />
                                <TextBox Text="{Binding Password}"
                                         Watermark="Leave empty to keep existing password when editing"
                                         PasswordChar="•"
                                         Background="{DynamicResource SurfaceBrush}"
                                         Foreground="{DynamicResource TextPrimaryBrush}" />
                                <TextBlock Text="Tip: Leave empty to keep current password when editing"
                                           Classes="secondary"
                                           FontStyle="Italic"
                                           TextWrapping="Wrap" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Bottom Action Bar -->
        <StackPanel Grid.Row="1" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    Spacing="10"
                    Margin="0,20,0,0">
            <Button Content="New"
                    MinWidth="100"
                    x:Name="NewButton"
                    Command="{Binding NewSiteCommand}"
                    Background="{DynamicResource SurfaceBrush}"
                    Foreground="{DynamicResource TextPrimaryBrush}" />
            <Button Content="Save"
                    MinWidth="100"
                    x:Name="SaveButton"
                    Command="{Binding SaveCommand}"
                    Background="{DynamicResource SurfaceBrush}"
                    Foreground="{DynamicResource TextPrimaryBrush}" />
            <Button Content="Delete"
                    MinWidth="100"
                    x:Name="DeleteButton"
                    Command="{Binding DeleteCommand}"
                    Background="{DynamicResource SurfaceBrush}"
                    Foreground="{DynamicResource TextPrimaryBrush}" />
            <Button Content="Connect"
                    MinWidth="100"
                    x:Name="ConnectButton"
                    Command="{Binding ConnectCommand}"
                    Background="{DynamicResource SurfaceBrush}"
                    Foreground="{DynamicResource TextPrimaryBrush}" />
        </StackPanel>
    </Grid>
</UserControl>
